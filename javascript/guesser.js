const Oregon = {
  levels: {
    0: {
      rooms: {
        1: {
          coordinates: "300,375,443,373,442,231,406,230,408,318,297,317",
          roomName: "Freezer",
        },
        2: {
          coordinates: "297,376,344,376,345,407,369,414,370,442,299,441",
          roomName: "Freezer Stairs",
        },
        3: {
          coordinates: "448,387,448,315,599,316,599,364,548,365,547,387",
          roomName: "Laundry",
        },
        4: {
          coordinates: "502,391,560,392,559,370,591,369,587,468,502,468",
          roomName: "Laundry Stairs",
        },
        5: {
          coordinates: "448,186,492,186,492,311,450,311",
          roomName: "Highway",
        },
        6: {
          coordinates: "446,96,448,183,535,182,535,141,589,139,587,98",
          roomName: "Boiler",
        },
        7: {
          coordinates: "593,97,668,96,668,183,654,183,655,278,592,279",
          roomName: "Blue Bunker",
        },
        8: {
          coordinates: "494,187,589,189,589,312,549,312,546,271,494,272",
          roomName: "Supply",
        },
        9: {
          coordinates: "490,16,546,17,546,68,531,67,530,93,491,94",
          roomName: "Tower Stairs",
        },
        10: {
          coordinates: "496,312,495,276,545,276,544,312",
          roomName: "Closet",
        },
        11: {
          coordinates: "535,180,535,144,586,144,587,182",
          roomName: "Electricity Room",
        },
      },
    },
    1: {
      rooms: {
        1: {
          coordinates: "635,438,715,438,712,322,635,320",
          roomName: "Garage",
        },
        2: {
          coordinates: "630,322,629,106,535,108,534,152,483,154,482,320",
          roomName: "Meeting",
        },
        3: {
          coordinates: "448,106,528,107,528,145,479,148,477,220,449,220",
          roomName: "Green Corridor",
        },
        4: {
          coordinates: "448,63,448,102,632,101,635,10,589,10,589,63",
          roomName: "Storage",
        },
        5: {
          coordinates: "176,214,312,214,314,320,178,320",
          roomName: "Dining",
        },
        6: {
          coordinates:
            "55,416,171,416,171,214,143,214,142,268,115,268,116,297,87,298,88,315,57,316",
          roomName: "Small Tower",
        },
        7: {
          coordinates: "56,267,114,267,114,293,84,294,83,314,57,314",
          roomName: "Small Tower Stairs",
        },
        8: {
          coordinates: "177,327,281,328,281,417,177,417",
          roomName: "Showers",
        },
        9: {
          coordinates: "315,451,315,329,286,328,287,423,143,424,143,450",
          roomName: "Shower Corridor",
        },
        10: {
          coordinates: "320,321,479,322,477,228,320,227",
          roomName: "Kitchen",
        },
        11: {
          coordinates: "320,328,447,328,447,372,319,372",
          roomName: "Security",
        },
        12: {
          coordinates: "432,418,433,440,350,443,350,451,320,450,320,417",
          roomName: "White Stairs",
        },
        13: {
          coordinates:
            "320,379,451,377,452,329,539,328,539,358,476,358,477,411,349,409,349,417,321,418",
          roomName: "Z Hall",
        },
        14: {
          coordinates: "481,364,534,364,536,474,482,473",
          roomName: "Classroom",
        },
        15: {
          coordinates: "532,62,586,62,586,11,531,10",
          roomName: "Tower Stairs",
        },
        16: {
          coordinates:
            "541,328,629,327,629,359,600,360,597,431,580,432,581,461,595,462,595,472,541,474",
          roomName: "Main Hall",
        },
        17: {
          coordinates: "629,368,603,367,603,432,583,433,582,460,627,461",
          roomName: "Main Stairs",
        },
      },
    },
    2: {
      rooms: {
        1: {
          coordinates: "28,371,30,274,97,275,98,373",
          roomName: "Small Tower Stairs",
        },
        2: {
          coordinates: "102,274,105,372,212,372,212,275",
          roomName: "Office",
        },
        3: {
          coordinates: "301,464,414,463,413,428,301,426",
          roomName: "White Stairs",
        },
        4: {
          coordinates: "564,65,564,10,622,11,622,102,465,102,463,66",
          roomName: "Big Tower",
        },
        5: {
          coordinates: "517,9,564,9,564,63,517,62",
          roomName: "Tower Stairs",
        },
        6: {
          coordinates: "524,230,565,229,566,108,523,109",
          roomName: "Attic",
        },
        7: {
          coordinates: "565,234,441,235,443,286,565,285",
          roomName: "Connector",
        },
        8: { coordinates: "437,237,300,235,302,320,435,319", roomName: "Kids" },
        9: { coordinates: "301,327,420,328,421,422,301,421", roomName: "Dorm" },
        10: {
          coordinates: "442,292,512,292,514,360,423,359,424,328,441,327",
          roomName: "Main Hall",
        },
        11: {
          coordinates: "518,291,583,293,583,360,519,360",
          roomName: "Trophy Room",
        },
        12: {
          coordinates: "428,366,512,367,510,420,428,419",
          roomName: "Games Room",
        },
        13: {
          coordinates: "467,427,513,427,513,457,467,457",
          roomName: "Closet",
        },
        14: {
          coordinates: "589,295,611,295,614,472,589,470",
          roomName: "Main Stairs",
        },
        15: {
          coordinates: "619,331,698,331,700,420,620,422",
          roomName: "Armory",
        },
        16: {
          coordinates: "519,366,584,366,583,457,519,456",
          roomName: "Master Bedroom",
        },
      },
    },
  },
};

const Border = {
  levels: {
    1: {
      rooms: {
        1: {
          coordinates: "149,350,147,206,231,205,232,351",
          roomName: "Supply",
        },
        2: {
          coordinates: "275,205,275,53,393,53,395,119,354,162,354,204",
          roomName: "Servers",
        },
        3: {
          coordinates: "145,455,146,392,231,392,231,456",
          roomName: "Jail",
        },
        4: {
          coordinates: "415,337,416,457,496,457,496,336",
          roomName: "Pass",
        },
        5: {
          coordinates:
            "232,454,234,271,275,271,274,332,331,334,359,303,358,271,396,272,413,288,413,454",
          roomName: "Customs",
        },
        6: {
          coordinates: "147,353,230,351,230,389,147,390",
          roomName: "Jcon",
        },
        7: {
          coordinates: "234,271,233,208,356,208,357,271",
          roomName: "Main Stairs",
        },
        8: {
          coordinates: "496,458,496,334,536,294,624,295,625,456",
          roomName: "Waiting Room",
        },
        9: {
          coordinates: "625,293,660,293,660,287,698,288,699,456,627,454",
          roomName: "East Stairs",
        },
        10: {
          coordinates:
            "357,215,493,217,494,172,535,172,535,291,495,333,415,333,415,287,394,271,359,270",
          roomName: "Lobby",
        },
        11: {
          coordinates: "496,54,658,52,659,172,493,171",
          roomName: "Bathroom",
        },
        12: {
          coordinates: "536,174,659,174,658,294,537,291",
          roomName: "Tellers",
        },
        13: {
          coordinates: "396,55,492,56,491,212,358,211,357,162,397,121",
          roomName: "Workshop",
        },
        14: {
          coordinates: "276,331,276,272,357,272,355,305,331,331",
          roomName: "Admin",
        },
        15: {
          coordinates: "182,55,273,55,274,163,182,164",
          roomName: "Vent",
        },
        16: {
          coordinates: "182,166,273,164,274,205,182,204",
          roomName: "Front Con",
        },
      },
    },
    2: {
      rooms: {
        1: {
          coordinates: "508,422,599,421,599,373,641,373,640,455,507,456",
          roomName: "Catwalk",
        },
        2: {
          coordinates: "367,455,366,270,193,270,191,455",
          roomName: "CC",
        },
        3: {
          coordinates: "193,201,190,48,282,47,284,206",
          roomName: "Armory",
        },
        4: {
          coordinates: "284,47,410,45,412,165,364,166,364,146,284,145",
          roomName: "Africa",
        },
        5: {
          coordinates: "367,333,506,331,506,456,368,454",
          roomName: "Break Room",
        },
        6: {
          coordinates: "640,291,710,290,711,456,676,456,675,418,644,418",
          roomName: "East Stairs",
        },
        7: {
          coordinates: "367,202,411,200,410,291,506,290,506,331,368,331",
          roomName: "90",
        },
        8: {
          coordinates: "414,165,507,165,510,289,412,291",
          roomName: "Fountain",
        },
        9: {
          coordinates:
            "511,281,553,282,551,293,637,293,637,334,509,334,507,294",
          roomName: "Office Hall",
        },
        10: {
          coordinates: "Archives",
          roomName: "411,5,515,6,516,50,506,51,508,82,566,83,567,126,547,162,412,161,412,46",
        },
        11: {
          coordinates: "Mini",
          roomName: "286,145,362,146,364,202,287,202",
        },
        12: {
          coordinates: "287,203,364,204,366,267,286,265",
          roomName: "Main Stairs",
        },
        13: {
          coordinates: "365,168,411,165,412,198,366,198",
          roomName: "Beepers",
        },
        14: {
          coordinates: "567,84,641,84,640,290,553,287,552,279,510,280,510,164,549,163,568,132",
          roomName: "Office",
        },
        15: {
          coordinates: "642,205,677,205,677,287,643,287",
          roomName: "Office Wall",
        },
      },
    },
  },
};

let points = 0;
let round = 1;
let gameRunning = false;

function startGame() {
  removeMenu();
  resetGame();
  if (!gameRunning) {
    gameRunning = true;
    console.log("Start");
    setupRound();
  }
}

function resetGame() {
  points = 0;
  round = 0;
}

function removeMenu() {
  document.getElementById("menu").remove();
}

function nextRound() {
  if (round <= 9) {
    if (gameRunning) {
      round++;
      console.log(`Moving to round ${round}`);
      setupRound();
    }
  } else {
    showEndScreen();
    gameRunning = false;
  }
}

function showEndScreen() {
  const imageContainer = document.getElementById("image-container");
  const endScreen = createElement("div", { id: "menu" });
  const result = createElement("h2", {
    id: "result",
    innerHTML: `Az eredményed:<br> ${points}/10`,
  });
  const button = createElement("button", {
    id: "button",
    innerText: "Vissza a menübe",
    onclick: goToMenu,
  });

  endScreen.append(result, button);
  imageContainer.appendChild(endScreen);
}

function setupRound() {
  const imageContainer = document.getElementById("image-container");
  const randomFloor = getRandomFloor();
  const theRoomToFind = getRoomToFind(randomFloor);
  const title = createElement("h2", {
    id: "title",
    innerHTML: `Találd meg ezt a szobát:<br> ${theRoomToFind}`,
  });
  const img = createImage(randomFloor);

  imageContainer.append(img, title);
  setupImageMap(randomFloor, theRoomToFind);
}

function getRandomFloor() {
  const floors = ["second_floor", "first_floor", "basement"];
  return floors[Math.floor(Math.random() * floors.length)];
}

function getFloorIndex(floor) {
  return ["basement", "first_floor", "second_floor"].indexOf(floor);
}

function createImage(floor) {
  return createElement("img", {
    id: "img",
    src: `../Images/Oregon_blueprints/r6-maps-oregon-blueprint-${
      getFloorIndex(floor) + 1
    }.jpg`,
    useMap: "#imageMap",
  });
}

function getRoomToFind(floor) {
  const rooms = Object.values(Oregon.levels[getFloorIndex(floor)].rooms);
  return rooms[Math.floor(Math.random() * rooms.length)].roomName;
}

function setupImageMap(floor, targetRoom) {
  const map = createElement("map", { name: "imageMap", id: "map" });
  document.getElementById("image-container").appendChild(map);

  Object.values(Oregon.levels[getFloorIndex(floor)].rooms).forEach(
    (roomData) => {
      const area = createElement("area", {
        shape: "poly",
        coords: roomData.coordinates,
        id: roomData.roomName,
        onclick: () => handleRoomClick(roomData.roomName, targetRoom),
      });

      map.appendChild(area);
    }
  );
}

function handleRoomClick(clickedRoom, targetRoom) {
  console.log(clickedRoom);
  if (clickedRoom === targetRoom) points++;
  cleanUpRound();
  nextRound();
}

function cleanUpRound() {
  ["map", "title", "img"].forEach((id) => document.getElementById(id).remove());
}

function goToMenu() {
  removeMenu();
  const menu = createElement("div", { id: "menu" });
  const title = createElement("h1", { innerText: "Menü" });
  const description = createElement("p", {
    innerText:
      'Ez a játék igénybe fogja venni a tájékozódási képességedet az "Oregon" nevű pályán. Kapni fogsz egy szobanevet és jól meg kell tippelned, hogy hol található.',
  });
  const startButton = createElement("button", {
    id: "button",
    innerText: "Kezdés",
    onclick: startGame,
  });

  menu.append(title, description, startButton);
  document.getElementById("content").appendChild(menu);
}

// instead of document.createElement()
function createElement(tag, properties = {}) {
  const element = document.createElement(tag);
  Object.assign(element, properties);
  return element;
}